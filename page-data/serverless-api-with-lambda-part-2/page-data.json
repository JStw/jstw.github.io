{"componentChunkName":"component---src-templates-blog-post-js","path":"/serverless-api-with-lambda-part-2/","result":{"data":{"site":{"siteMetadata":{"title":"Jstw Blog"}},"markdownRemark":{"id":"217e8926-2a80-52d6-961c-3a61afad6911","excerpt":"Hey folks! If you didn’t read the previous post, I suggest you to read it  before continuing. If you did, let’s continue! At this step, you normally have a…","html":"<p>Hey folks! If you didn’t read the previous post, I suggest you to <a href=\"../serverless-api-with-lambda-part-1\">read it</a>  before continuing. If you did, let’s continue!</p>\n<p>At this step, you normally have a beautiful database which only asking to be queried. Let’s move on to the first step.</p>\n<h3>First step: define our Lambda Role</h3>\n<p>Yeah I know, you wanted to start coding a little bit, but you have to wait again :)</p>\n<p>If you remember our architecture schema :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/a712c81b450295927c99906ae5442c82/f349c/archi.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 41.21621621621622%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAACeElEQVQozx1SXUhTARg9u9fde3c3FLFU1BRzQ0ydZjq1/Jm/I+1uV91yztWWzrH8m3N6NzfdTKFiqSkhhFDRSyI9Bb1UCEkUSWgGhWU+9RAEQYTPcbvzg8P3PZ3vO+d8KKhoQv65BkxMReEcDQCIIflyAJQxTCu5KMPyYSbJ5KORs00uu5sytjyaZkNHBwtugWJNAk3xIfqUdYXNtq4o5KYQA3VpHfJK6qDRVsNhNaPC4gFhihJUxxQF1QQqO6fxb76MEHXAjv+s4ftk4c/fA6Rq/Yoaoijtty/B6d2DZegtZO1TNE5ra2S5xTVkuroMtl47Md5vI5LavAQaR+RH4l+UNbcSM5GIsmf+EXGYB9kDd+3JONPqnBdr99ZAQoGhyf3aUeFbdWb/LI1CXYvmjK650mJ3KQIBIdU/Gkz3LvLJroubVTOWnc9C12vu+JJ6Ee/9FfpDf/6bZ4O6FOfNDfZ2xKWIzC6ecFz/8sc5uP8jq08iLKpqKZB8bDf3OJKDQSHN7w2mD8/2pLnaX5RPmz9sCp1bTYAIcRXYHi7I2vOXuO+HB1J80TuqaHhCGYstKN1jO8OesV13at8cjacPl2TOa310Ro4GlVXVRGNJtozQWklw3XK5BhQapZjCAotlkXg3Xl781Zd/9xcH6rm3Hv7HL3EjHMKGJEG/LslojVA4OngFm90B3Xk9DPoLyGu1Ad0xmZKfoRCvti7gkoiPnkx88hWVHgjFT45GEpm1q1rEL0fOpGSp1HMBhpdC4TqtMHBmNBiMMPS6gZYFqHhBJjeGFAwXoWlTmE6QkGgap5G1Sx77yd2ildLLkMYQnSCB5YOMkg/GZ8V/fbPCWLcDHaIAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Architecture\"\n        title=\"Architecture\"\n        src=\"/static/a712c81b450295927c99906ae5442c82/fcda8/archi.png\"\n        srcset=\"/static/a712c81b450295927c99906ae5442c82/12f09/archi.png 148w,\n/static/a712c81b450295927c99906ae5442c82/e4a3f/archi.png 295w,\n/static/a712c81b450295927c99906ae5442c82/fcda8/archi.png 590w,\n/static/a712c81b450295927c99906ae5442c82/efc66/archi.png 885w,\n/static/a712c81b450295927c99906ae5442c82/c83ae/archi.png 1180w,\n/static/a712c81b450295927c99906ae5442c82/f349c/archi.png 2002w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Our Client-Side App will query our API. The API Gateway will invoke some Lambda Functions, and those lambdas will interact with our DynamoDB blog table.</p>\n<p>But, to allow those interactions between our different AWS Services, we must configure an <strong>IAM role</strong> with particular <strong>IAM policies</strong>.</p>\n<blockquote>\n<p>If you want to know what are the IAM roles, why we need them, I’ll provide you the link to the  <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_roles.html\">IAM AWS Official Documentation</a>. </p>\n</blockquote>\n<p>Let’s navigate to the IAM Service through <code class=\"language-text\">Security, Identity, &amp; Compliance &gt; IAM</code>.</p>\n<p>Before creating our IAM role, we will create the policy which will be attached to our role. For that, click on <code class=\"language-text\">Policies &gt; Create Policy</code>.</p>\n<blockquote>\n<p>By default, an explicit deny is set to all resources created in AWS. You must grant permission via IAM Policies. and attach them to your resources. If you want more information about IAM Roles, Policies, Groups, have a look <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/id.html\">to the official documentation of IAM</a>.</p>\n</blockquote>\n<p>Choose the <code class=\"language-text\">JSON</code> editor tab and copy-paste this following JSON policy :</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"Version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"2012-10-17\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"Statement\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"dynamodb:Query\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"dynamodb:DeleteItem\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"dynamodb:GetItem\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"dynamodb:PutItem\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"dynamodb:Scan\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"dynamodb:UpdateItem\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"arn:aws:dynamodb:*:*:table/*/index/*\"</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">\"arn:aws:dynamodb:&lt;&lt; put your region here >>:&lt;&lt; insert your account id here >>:table/blog\"</span>\n            <span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token property\">\"Effect\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Allow\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Action\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"lambda:InvokeFunction\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token property\">\"Resource\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"*\"</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>Do not forget to change the <strong>region</strong> and the <strong>account id</strong> inside the <strong>Resource ARN</strong> bloc. The region is the one selected in the AWS Console navigation bar, and your account id can be found by checking the IAM users sign-in link in the IAM Dashboard.</p>\n</blockquote>\n<p>Finally, you can hit the Next button to review your policy, add a name, and create your policy. You should have  a screen like this :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/36efbd4cccb2c7b9b914ffd8cca06d30/68638/iampolicy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABJ0AAASdAHeZh94AAAA9UlEQVQoz5VR2W7EIBDj/z8w2rw02SUNZKNc5D5dTAXaVqraWnKAmYnxDKKqKvR9j/M8sa4r9n3Hd1zXFfgbBD/zPMOYHhTvus6dx3HENE2OvIQXvgr/REFXxpgg4jkMgyPd80zBv1B4q8dxYNu2L6Qzxv8DQVW6oBs6oeNlWazg6kQZYwe+husrfTc+L9j3aamUQpre8SxLaF3gLUkgswxFUUBKiczu49sNSZq6PZnYmiiKEMexq8nz/FOQaNsWj0dmxRR0UULmT7zr0rnzDpqmCU5I5hjjQ3q3QdCMG5p+DfNUSqOu6zBD1vFnPp4HR0P6PPEB80JtBNWTH8QAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"IAM Policy\"\n        title=\"IAM Policy\"\n        src=\"/static/36efbd4cccb2c7b9b914ffd8cca06d30/fcda8/iampolicy.png\"\n        srcset=\"/static/36efbd4cccb2c7b9b914ffd8cca06d30/12f09/iampolicy.png 148w,\n/static/36efbd4cccb2c7b9b914ffd8cca06d30/e4a3f/iampolicy.png 295w,\n/static/36efbd4cccb2c7b9b914ffd8cca06d30/fcda8/iampolicy.png 590w,\n/static/36efbd4cccb2c7b9b914ffd8cca06d30/efc66/iampolicy.png 885w,\n/static/36efbd4cccb2c7b9b914ffd8cca06d30/c83ae/iampolicy.png 1180w,\n/static/36efbd4cccb2c7b9b914ffd8cca06d30/68638/iampolicy.png 1510w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Let me explain a little bit about what this policy does. The first <code class=\"language-text\">Effect</code> will allow our resources (lambdas) to make some basics interactions with DynamoDB, for example, <strong>Query, Scan or PutItem</strong>, etc. For these specifics actions, we should fill the ARNs of our DynamoDB table/indexes.</p>\n<blockquote>\n<p>You always should follow one of the best practices in AWS, the <a href=\"https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html#grant-least-privilege\">Principle of Least Privileges</a>.</p>\n</blockquote>\n<p>I will not explain the second effect bloc (the <strong>lambda:InvokeFunction</strong>) for now, I’ll keep it for later.</p>\n<p>Our IAM Policy has been created and we can finally create our IAM Role. Go back to the IAM Dashboard (<code class=\"language-text\">Services &gt; Security, Identity &amp; Compliance &gt; IAM</code>). Click on <code class=\"language-text\">Roles &gt; Create a role</code>.</p>\n<p>Keep the first selected option (trusted entity), then chose <code class=\"language-text\">Lambda</code> and click to <code class=\"language-text\">Next: Permissions</code>. Search our policy previously created by typing his name and select it like below :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/d9777715be2c3552e071d8ef5fe52d59/fe8a7/policyrole.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 31.756756756756754%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABJ0AAASdAHeZh94AAAA70lEQVQY022Q646EIAyFef8n2xfYxHHUjDcU0MEL43o/WzD82bXJF9pDW1qYMQZaawzDgHVdHfu+w9t5nvhrVvP6g4/4ijR5B9ZtA/MN27aFUsrR9z2WZXGNffFxHLdc95dvjXWdhhQ1zDjSdJtrNM+zwyfdTXln0zSBlbVCEGdo3toJfjLLRivYR+xpzIcmH9zXeOx29pRSoqoqCCHBCi4QRC88whBJkpAortUpSamLhmLOS+R5jsJS5MjSFNHzSVqGOIoQUr3NYbw1KFSHIJX4fjV48g5lM/7D5lVvz4dqesSFBKdYdBNqPaEdfvALyT/MEWSeneQAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"IAM Policy Role\"\n        title=\"IAM Policy Role\"\n        src=\"/static/d9777715be2c3552e071d8ef5fe52d59/fcda8/policyrole.png\"\n        srcset=\"/static/d9777715be2c3552e071d8ef5fe52d59/12f09/policyrole.png 148w,\n/static/d9777715be2c3552e071d8ef5fe52d59/e4a3f/policyrole.png 295w,\n/static/d9777715be2c3552e071d8ef5fe52d59/fcda8/policyrole.png 590w,\n/static/d9777715be2c3552e071d8ef5fe52d59/efc66/policyrole.png 885w,\n/static/d9777715be2c3552e071d8ef5fe52d59/c83ae/policyrole.png 1180w,\n/static/d9777715be2c3552e071d8ef5fe52d59/fe8a7/policyrole.png 1223w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>You can now click on the <code class=\"language-text\">Next: Tags</code> and click on <code class=\"language-text\">Next: Review</code> to finally give a name to your role and create it.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0e4fe6d90009bcd47c37629bd3129650/85053/createrole.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.1891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABJ0AAASdAHeZh94AAABaklEQVQ4y41TSVLEMAzM33kIL+DEFzhx4wccoCphJuPdsbO4kWw85UnYVNWl2JE7rbbSWWshpQTnbdvwU6SUMvZ767oibSukDXh47tGN4wghRH6xLEspoEImL0jXD1XSFrVuoXPSzei89zDGZLBKzn3fYzyfcTqdMAxDhtbqizgxc9XYoES3b40VTtOEECOE0rhIBaUNhNQ5a2OhrcMUIlZSvxDa3LXyOVihlALKOAjtIIlE6kIilMlrRWveiwu3mjCvhXCat1uFrelUAx+3fGiPUJ+pKC4FTHolbBXyxczznMGeWlJmKHOrnLlVP4WcSVRus2IjjgMhXxJfhiTvuE1lChmThxDwVxw85GB1jlTYmKCmFX5Oh3ksOI7SjYfOuTyTSqn87J0luAJS/ts8Xgn5IBPUP4U9rAPegt+1XeyJsod1bLiYD/0V39lz8JBb5H+Zo6r4Dz50pEvzOA/veHm94O7xDfdPAz4B6kr732dvFyMAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"IAM Role created\"\n        title=\"IAM Role created\"\n        src=\"/static/0e4fe6d90009bcd47c37629bd3129650/fcda8/createrole.png\"\n        srcset=\"/static/0e4fe6d90009bcd47c37629bd3129650/12f09/createrole.png 148w,\n/static/0e4fe6d90009bcd47c37629bd3129650/e4a3f/createrole.png 295w,\n/static/0e4fe6d90009bcd47c37629bd3129650/fcda8/createrole.png 590w,\n/static/0e4fe6d90009bcd47c37629bd3129650/efc66/createrole.png 885w,\n/static/0e4fe6d90009bcd47c37629bd3129650/c83ae/createrole.png 1180w,\n/static/0e4fe6d90009bcd47c37629bd3129650/85053/createrole.png 1225w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Good job! Your role is now ready to be used. I think it’s time for coding!</p>\n<p>You can now navigate to the Lambda Service trough: <code class=\"language-text\">Services &gt; Compute &gt; Lambda</code>.</p>\n<h3>Second step: Create our lambda functions</h3>\n<p>We will start to create a first Lambda Function which will read out the content of our DynamoDB blog table.</p>\n<p>So hit the <code class=\"language-text\">Create Function</code> button and keep the selected creation option (Author from scratch). Choose a name for your Lambda Function, <code class=\"language-text\">GetArticles</code> for example, and go for the <code class=\"language-text\">Python 3.8</code> language runtime.</p>\n<p>Before creating our function, one last important step is to select our IAM Role previously created. Open the Permissions just below, click on <code class=\"language-text\">Use an existing role</code> and select your service role from the selected list like this:</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0cef0d74d8b2190f77db61124d3f33f4/fbfd6/lambdarole.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABLElEQVQoz5VSi46DIBD0/7/zrKdSLW8UcG8Hxdiml7QkkxXEcXZmGyEEtW1LPwxrLcUYaV3XgmVZvkYjpaRxFGSMpRBwuBPlnGnbtlK/QaO1KYTWOYYnx8Cz855SSuVS+gC4h9UopUhMDyYI5BkggspKBpWfIDMKoZSK+mGkwCSRSeDh2W5t+dp6Pd/y07t1jTshWp7mmaRx5RBhBPbQh1AqfMUzVNd9xXLsF/4GCyIatAiVSFgbU5DeBFL3r76ly/tCCLKBW1ZK74Ss2FrHfvozcdihPFuSd5/erZNw1o6634Fn8UbiPtE8P+jO1XHS14uJyf6nuxBC2cjDDQL4AQugEOEg6VfEeNQa4EFUVxnsW9exyp76fiDFLaPVOkIIBLiOVa1A/TECkzyCf//VXauUcQMnAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Lambda use role\"\n        title=\"Lambda use role\"\n        src=\"/static/0cef0d74d8b2190f77db61124d3f33f4/fcda8/lambdarole.png\"\n        srcset=\"/static/0cef0d74d8b2190f77db61124d3f33f4/12f09/lambdarole.png 148w,\n/static/0cef0d74d8b2190f77db61124d3f33f4/e4a3f/lambdarole.png 295w,\n/static/0cef0d74d8b2190f77db61124d3f33f4/fcda8/lambdarole.png 590w,\n/static/0cef0d74d8b2190f77db61124d3f33f4/efc66/lambdarole.png 885w,\n/static/0cef0d74d8b2190f77db61124d3f33f4/c83ae/lambdarole.png 1180w,\n/static/0cef0d74d8b2190f77db61124d3f33f4/fbfd6/lambdarole.png 1357w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Then create your function. you will be redirected to your Lambda.</p>\n<p>Scroll down a little bit to your Lambda Code Editor. In this Lambda, we just want to retrieve all Articles from our table. For that, we will use the <code class=\"language-text\">Scan</code> operation that will just basically reads every item in a table. (More information <a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Scan.html\">here</a>).</p>\n<p>Copy/paste this following code in the editor :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token comment\"># Boto is the Amazon Web Services (AWS) SDK for Python</span>\n<span class=\"token keyword\">import</span> boto3\n\n<span class=\"token comment\"># To interact with DynamoDB, I just need to specify what resource I will use from boto3 (here: dynamodb)</span>\ndynamodb <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">(</span><span class=\"token string\">'dynamodb'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\"># Now I specify which table in DynamoDB I want to interact with.</span>\ntable <span class=\"token operator\">=</span> dynamodb<span class=\"token punctuation\">.</span>Table<span class=\"token punctuation\">(</span><span class=\"token string\">'blog'</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># Here, I will use a scan operation, to retrieve ALL my table items.</span>\n        response <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span>scan<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\"># Finally, I just return all the Items I found.</span>\n        <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">'Items'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># If an exception was thrown, I just catch it to print a log, and then I raise the error.</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'An error occurred while retrieving Movies table.'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">raise</span> e</code></pre></div>\n<p>No more explanations needed for this code, it’s quite simple, we just import the boto3 library to use the Dynamodb client. We surround our scan operation with the try/catch operator and finally, we return the Items.</p>\n<p>You can now this Lambda code by clicking <code class=\"language-text\">Save</code> at the top of the page, and now it’s time for testing :)</p>\n<p>Just near the Save button, you can create a <code class=\"language-text\">Test Event</code> to trigger our function handler.</p>\n<blockquote>\n<p>FYI: Every AWS Lambda function contains at least 2 parameters :</p>\n</blockquote>\n<blockquote>\n<p><strong>event</strong> – AWS Lambda uses this parameter to pass in event data to the handler.</p>\n</blockquote>\n<blockquote>\n<p><strong>context</strong> – AWS Lambda uses this parameter to provide runtime information to your handler.</p>\n</blockquote>\n<p>Click on the <code class=\"language-text\">Test</code> button, choose an event name (For example TestGetItems), and leave the rest as is. Your <code class=\"language-text\">TestGetItems</code> is now part of your test events. Ready to test your lambda? Push the test button again ;)</p>\n<p>Normally you should see a success box like this :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/7490e24607018932f2231dbd1ee9b52b/bf8c1/getarticleslambdatest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 43.91891891891892%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABPUlEQVQoz5VRa2/CMAzM//+HmwQaUPrOw2mS0lK42YGibmgfFunk2r67Oo762H1if9ijtz00aRhv4YKDGwSPb0MGnenQMjrLUbfoXc95C588LGu001mjSlPgUH/h3J9wbI4obQ0T+yf0I4b+VbOJhaPJIIbka00zT5mBE+8wpAFD9PCBHtNxzY8JFDyIc+I6DYRxSpiWC6brBpxLXbxUmiPIEbTmP1mHECJSGrEsC/5zluvCa+jYcAqIbEJE2WyeZ9xv93fF/Ym/Dvco8g5tMPlK45yQpojAV79cxzfka27wuy968VKlLrAvdqhMidpWaBgdNbxw+1w8x2Rwao+o9Bm1qXK0/GArZ8tTYlDrkl9SZ5JAGv7iXpC8aE/QQ5eFq9mWs/JUzZNVbCikbVMEq0iiGBY8ZeuaH/VtFMNvI1qznMJzE7UAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Lambda GetArticles Success\"\n        title=\"Lambda GetArticles Success\"\n        src=\"/static/7490e24607018932f2231dbd1ee9b52b/fcda8/getarticleslambdatest.png\"\n        srcset=\"/static/7490e24607018932f2231dbd1ee9b52b/12f09/getarticleslambdatest.png 148w,\n/static/7490e24607018932f2231dbd1ee9b52b/e4a3f/getarticleslambdatest.png 295w,\n/static/7490e24607018932f2231dbd1ee9b52b/fcda8/getarticleslambdatest.png 590w,\n/static/7490e24607018932f2231dbd1ee9b52b/efc66/getarticleslambdatest.png 885w,\n/static/7490e24607018932f2231dbd1ee9b52b/c83ae/getarticleslambdatest.png 1180w,\n/static/7490e24607018932f2231dbd1ee9b52b/bf8c1/getarticleslambdatest.png 1722w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Well, I think we can claim our first beer, we successfully created our first lambda which reads our DynamoDB items, congrats!</p>\n<h3>Third step: Create the other lambda functions</h3>\n<p>The other Lambda will represent all the CRUD operations you can found in an API. Remember, the goal is to call these Lambda functions with API Gateway.</p>\n<p>So this is what is remaning for our Lambda :</p>\n<ul>\n<li>Retrieve all blog articles (GetArticles - done)</li>\n<li>Find an article by title and category (FindByTitleAndCategory - TBD)</li>\n<li>Create an article (CreateArticle - TBD)</li>\n<li>Update an article (UpdateArticle - TBD)</li>\n<li>Delete an article (DeleteArticle - TBD)</li>\n</ul>\n<p>Let’s move on! Go back to the main Lambda screen, by clicking <code class=\"language-text\">Services &gt; Compute &gt; Lambda</code>. Then, do the same job as you did before by clicking <code class=\"language-text\">Create Function</code>. Keep the same settings we did for the <strong>GetArticles</strong> Lambda function.</p>\n<p>This time, we will tackle our second lambda in the list, the <code class=\"language-text\">FindByTitleAndCategory</code>. Lambda settings should be the same :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/20859cd36e1fe92e375b56f725693773/b5a09/findbytitlecategory.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABIUlEQVQoz51Ti26DMBDL/3/mHmIlaYCEvCDg+UKZJk3b2iJZkeDw+eyLstai6zr0vUaMEbWuWJblaSg/z9DGwHmPnDNR2lm3DTuAfd/vB+sbYa8NzNViDgExJYSYqDZhXSs2Etd/sN0gpMo5B02yVBaUUhqhSH9IGSHEaAo5quHIIeUfXeud6mqtnGY9CEOIGMeJHobmX2o+5m9+8h2bFU5w+pvOb+Wol8lw81tJssMwINC/mX6Kp7VuXwWPQg2Tw9t7hwvXxtoBwzjCsoFzvnU+lU6Ra3FHI+VixoUp91q30SeGJKeM+MyjPAmuDEWUlObH4Ulh0uLRn5B9ZSCiTMJpiz0xjNcPg5dON+jRtz2UsOSnZZWb8/vtEUJJW+okj0+rCl3HdhvskgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Lambda FindBy Settings\"\n        title=\"Lambda FindBy Settings\"\n        src=\"/static/20859cd36e1fe92e375b56f725693773/fcda8/findbytitlecategory.png\"\n        srcset=\"/static/20859cd36e1fe92e375b56f725693773/12f09/findbytitlecategory.png 148w,\n/static/20859cd36e1fe92e375b56f725693773/e4a3f/findbytitlecategory.png 295w,\n/static/20859cd36e1fe92e375b56f725693773/fcda8/findbytitlecategory.png 590w,\n/static/20859cd36e1fe92e375b56f725693773/efc66/findbytitlecategory.png 885w,\n/static/20859cd36e1fe92e375b56f725693773/c83ae/findbytitlecategory.png 1180w,\n/static/20859cd36e1fe92e375b56f725693773/b5a09/findbytitlecategory.png 1360w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>Do not forget to attach our IAM role.</p>\n</blockquote>\n<p>Copy/paste this following Python code :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> boto3\n<span class=\"token comment\"># This new import will be used to specify which DynamoDB Key we use in the KeyConditionExpression.</span>\n<span class=\"token keyword\">from</span> boto3<span class=\"token punctuation\">.</span>dynamodb<span class=\"token punctuation\">.</span>conditions <span class=\"token keyword\">import</span> Key\n \nclient <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">(</span><span class=\"token string\">'dynamodb'</span><span class=\"token punctuation\">)</span>\ntable <span class=\"token operator\">=</span> client<span class=\"token punctuation\">.</span>Table<span class=\"token punctuation\">(</span><span class=\"token string\">'blog'</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># I'll explain you later why we take these values from the event \"pathParameters\" property.</span>\n        title <span class=\"token operator\">=</span> event<span class=\"token punctuation\">[</span><span class=\"token string\">'pathParameters'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">]</span>\n        category <span class=\"token operator\">=</span> event<span class=\"token punctuation\">[</span><span class=\"token string\">'pathParameters'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'category'</span><span class=\"token punctuation\">]</span>\n        \n        <span class=\"token comment\"># This time, we will use the query operation.</span>\n        response <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span>query<span class=\"token punctuation\">(</span>\n            ProjectionExpression<span class=\"token operator\">=</span><span class=\"token string\">\"title, category, author, content, createdAt\"</span><span class=\"token punctuation\">,</span>\n            KeyConditionExpression<span class=\"token operator\">=</span>Key<span class=\"token punctuation\">(</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>eq<span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;</span> Key<span class=\"token punctuation\">(</span><span class=\"token string\">'category'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>eq<span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n       \n        <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">'Items'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">except</span> Exception <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'An error occurred while retrieving an item in blog table.'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">raise</span> e</code></pre></div>\n<p>In this lambda, we just need to specify which fields we want to expose in our response thanks to the <code class=\"language-text\">ProjectionExpression</code>.</p>\n<p>The second one (the most important) is the <code class=\"language-text\">KeyConditionExpression</code> which will determine our conditional query expression (which article we want to query).</p>\n<blockquote>\n<p>You can find <a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Query.html\">here</a> the official documentation of a Query operation.</p>\n</blockquote>\n<p>Save your function, add a new test event but this time we will have to change a little bit the test event content by adding the requested params (title and category) :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/228597a51ece3eaf826ea0a6e71373b8/8f0f9/findbytest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 47.2972972972973%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABF0lEQVQoz52RbU+DMBSF+f//TDeXGGPYDCQyZMCwsEJfgBaOtwWn+7iRPDntue25NzSo6wZRHOMzSXA8psjzHMMwYBzHu3B3OG8RDEMPKSWUUh4p1XX/XwWhtb7x/tYLLjhgvEOSZsiyE9L0C0VRoqoqlOUZvG3R9/21mVu7UK2dp7237BeMMRTYaXBBEwhBAZ2/9OhnrUWgqQvnHM2Fw5AxTdPCPC9M8603/fqrt9Zn8vyEikb9ZswHuqKlorX34QJ7ehRH4H4mo0ClOupiaPDpYaylCXWvUZQMUcKQZC3OjSHsXVSrdpJeWYgWH/EJm1Dh+V1gG0rs9tLr9sCx2fNVL9gdJJ7ozIvTsCZt8RaPntdopOARP41Ft5oJKzGHAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"FindBy test event\"\n        title=\"FindBy test event\"\n        src=\"/static/228597a51ece3eaf826ea0a6e71373b8/fcda8/findbytest.png\"\n        srcset=\"/static/228597a51ece3eaf826ea0a6e71373b8/12f09/findbytest.png 148w,\n/static/228597a51ece3eaf826ea0a6e71373b8/e4a3f/findbytest.png 295w,\n/static/228597a51ece3eaf826ea0a6e71373b8/fcda8/findbytest.png 590w,\n/static/228597a51ece3eaf826ea0a6e71373b8/efc66/findbytest.png 885w,\n/static/228597a51ece3eaf826ea0a6e71373b8/8f0f9/findbytest.png 1045w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>Do not pay attention to our test event structure, but please respect it.</p>\n</blockquote>\n<p>Once your event has been created, just hit the Test button again and let’s see what we received :)</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1667a05bf6e5695273471845d00f3095/bf8c1/findbyresult.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 37.83783783783784%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABJ0AAASdAHeZh94AAABG0lEQVQoz5WRi27CMAxF+/8/CGIa0xiBtnmn5NFSuLNTqolt0rRKR7Z7oxvbaTYvW2x2W+xed1BOww3umYtDryWkUeh0D2lVrRXFVrb1jPGmwnnzdtrjbASEPOAgBdQgYS5EVNDMI1//2USXMpkxtV5RQ49G164sPHUyRI9AcO3iAMsEs9SPM/maUK6ZIjEt+YpPFk28RFhjYa1DShkxJkzTBNzv+O8XMo2cyYTNDJkGHzCWEbf59tPv/uAvQ+M1tZswzgVlzhhvZRmJxnmCR52/xvtNd8nQo4g9hDrSw5xw1qJGXr7Pti49FIvetTh072jtGS3pXLPuSWdcjbS2qNGclKjONi5wzmIorsZh9OjI6Nh/VG2F9e+w4Sdei2cbBTQO9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"FindBy test event\"\n        title=\"FindBy test event\"\n        src=\"/static/1667a05bf6e5695273471845d00f3095/fcda8/findbyresult.png\"\n        srcset=\"/static/1667a05bf6e5695273471845d00f3095/12f09/findbyresult.png 148w,\n/static/1667a05bf6e5695273471845d00f3095/e4a3f/findbyresult.png 295w,\n/static/1667a05bf6e5695273471845d00f3095/fcda8/findbyresult.png 590w,\n/static/1667a05bf6e5695273471845d00f3095/efc66/findbyresult.png 885w,\n/static/1667a05bf6e5695273471845d00f3095/c83ae/findbyresult.png 1180w,\n/static/1667a05bf6e5695273471845d00f3095/bf8c1/findbyresult.png 1722w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>This time, we just received 1 item based on the value passed in the test event. Our FindBy Lambda is now operational!</p>\n<p>Let’s move on, and make the <code class=\"language-text\">CreateArticle</code> one. The same process like before, create a new Lambda function with the same settings.</p>\n<p>Copy/paste this following code :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime\n<span class=\"token keyword\">from</span> botocore<span class=\"token punctuation\">.</span>exceptions <span class=\"token keyword\">import</span> ClientError\n        \ndynamodb_client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">(</span><span class=\"token string\">'dynamodb'</span><span class=\"token punctuation\">)</span>\ntable <span class=\"token operator\">=</span> dynamodb_client<span class=\"token punctuation\">.</span>Table<span class=\"token punctuation\">(</span><span class=\"token string\">'blog'</span><span class=\"token punctuation\">)</span>\n\nlambda_client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>client<span class=\"token punctuation\">(</span><span class=\"token string\">'lambda'</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token comment\"># here, we want to handle both cases: if we receive a body as string, or a body as object.</span>\n        <span class=\"token keyword\">if</span> <span class=\"token builtin\">type</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">[</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">:</span>\n            body <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">[</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            body <span class=\"token operator\">=</span> event<span class=\"token punctuation\">[</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">]</span>\n        \n        <span class=\"token comment\"># we extract this 2 properties to retrive the item inserted after.</span>\n        title <span class=\"token operator\">=</span> body<span class=\"token punctuation\">[</span><span class=\"token string\">'author'</span><span class=\"token punctuation\">]</span>\n        category <span class=\"token operator\">=</span> body<span class=\"token punctuation\">[</span><span class=\"token string\">'category'</span><span class=\"token punctuation\">]</span>\n        \n        createdAt <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strftime<span class=\"token punctuation\">(</span><span class=\"token string\">'%Y-%m-%dT%H:%M:%SZ'</span><span class=\"token punctuation\">)</span>\n        \n        response <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span>put_item<span class=\"token punctuation\">(</span>\n            Item<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">'title'</span><span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'category'</span><span class=\"token punctuation\">:</span> category<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'author'</span><span class=\"token punctuation\">:</span> body<span class=\"token punctuation\">[</span><span class=\"token string\">'author'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'content'</span><span class=\"token punctuation\">:</span> body<span class=\"token punctuation\">[</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'createdAt'</span><span class=\"token punctuation\">:</span> createdAt\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\"># According to the documentation, We can set a ReturnValues='ALL_NEW' property in our PutItem operation.</span>\n        <span class=\"token comment\"># But the the ALL_NEW isn't accepted for put_item.</span>\n        \n        <span class=\"token comment\"># The other solution is to re-query our database to get the item created.</span>\n        \n        <span class=\"token comment\"># But, re-query the DB is just re-triggering the same Job we did</span>\n        <span class=\"token comment\"># in our FindByTitleCategory lambda.</span>\n        \n        <span class=\"token comment\"># We have the possibility to invoke another Lambda in our Lambda</span>\n        invoke_response <span class=\"token operator\">=</span> lambda_client<span class=\"token punctuation\">.</span>invoke<span class=\"token punctuation\">(</span>\n            FunctionName<span class=\"token operator\">=</span><span class=\"token string\">\"FindByTitleCategory\"</span><span class=\"token punctuation\">,</span>\n            InvocationType<span class=\"token operator\">=</span><span class=\"token string\">'RequestResponse'</span><span class=\"token punctuation\">,</span>\n            Payload<span class=\"token operator\">=</span>json<span class=\"token punctuation\">.</span>dumps<span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token string\">\"pathParameters\"</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">,</span> <span class=\"token string\">\"category\"</span><span class=\"token punctuation\">:</span> category<span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">)</span>\n        \n        <span class=\"token comment\"># Finally, we need to convert our response in an object and return the</span>\n        <span class=\"token comment\"># payload received from our Lambda</span>\n        item <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>invoke_response<span class=\"token punctuation\">[</span><span class=\"token string\">'Payload'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">.</span>read<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>decode<span class=\"token punctuation\">(</span><span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">except</span> ClientError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string\">'An error occured while trying to insert a new movie'</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">raise</span> e\n        \n    <span class=\"token keyword\">return</span> item</code></pre></div>\n<p>Before configuring our test event, just some clarifications about this portion of code: </p>\n<ul>\n<li>First, to retrieve the body sent by the POST action, we want to handle the fact that the object passed in the body can be an object, but also a stringified object. That’s why we check the type of <code class=\"language-text\">event body</code>.</li>\n<li>Then, we use the <code class=\"language-text\">put_item</code> operation by simply passing the Item that we want to insert in the database.</li>\n<li>Finally, the official documentation is not clear, but it’s impossible to retrieve the item created when we use the <strong>put_item</strong> action. We need to query the DB again. But if you remember, we created already a Lamba (<strong>FindByArticleAndCategory</strong>) which is doing exactly what we want to retrieve an item. That’s why we added the <strong>Lambda:InvokeFunction</strong> policy in our IAM Role :) So when the <strong>put_item</strong> is done, we just invoke our <strong>FindByArticleAndCategory</strong> Lambda Function to retrieve our article created by providing his title and his category. It’s not the only way, and probably the right way to do that, but it’s one of the possibilities to do it. The other one is to query directly the database as we did in the FindByArticleAndCategory Lambda,.</li>\n</ul>\n<p>Ok so let’s create our test event :\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/12e4b13574727a42d9caeaecd02288ee/fd84e/createarticletest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 54.72972972972974%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABJ0AAASdAHeZh94AAABOUlEQVQoz52S2W6DQAxF+f9frBRVZAGG2Td2bm2SIJKXNh3pCNtYd2yPixACyvMZl8sVVV2jqir0w4BxHD+i73uwVpFzhtYa2hhY6wgLjnFC13U7mbjHXuPvfpFyh6oRaIi6aSBEu8G+MRYpJcQYN9g+co+n/d84TShc6nCVliozUNrAeY91XbEsCz49EwtymazuqX+eBYsxfJ72X9gFeTbcmlQK8zxvlc3E8iFcTEcz3gQVPYpzDtND8L+w6C4opaS2/UvCPC9b1dNvUKucNzwFhRBQxkNqj0Av5mNASAExp43huZfDgYc/HHaWbVqbvAnyPp1KifLW4lR/4+t2gjAtat1AOQUbLLSnLYgehr5sG4oxymm6OD5aJsGyPENIA6EiWh1Q0QPViuYaMgklEogH3v07nJepqB/XLFa8yvLoTQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"FindBy test event\"\n        title=\"FindBy test event\"\n        src=\"/static/12e4b13574727a42d9caeaecd02288ee/fcda8/createarticletest.png\"\n        srcset=\"/static/12e4b13574727a42d9caeaecd02288ee/12f09/createarticletest.png 148w,\n/static/12e4b13574727a42d9caeaecd02288ee/e4a3f/createarticletest.png 295w,\n/static/12e4b13574727a42d9caeaecd02288ee/fcda8/createarticletest.png 590w,\n/static/12e4b13574727a42d9caeaecd02288ee/efc66/createarticletest.png 885w,\n/static/12e4b13574727a42d9caeaecd02288ee/fd84e/createarticletest.png 1056w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Before testing our Lambda Function, because this one is a little bit more “tricky” than the other one, it’s possible to have some timeout when executing it. To avoid this problem, I suggest for this example to increase a little bit the “default” lambda settings. For that, change default timeout timer, up 3 to 10 seconds in the Lambda settings :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/29749a014314a0e79755c72ee3b176b4/d0143/lambdatimeout.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 64.86486486486486%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABJ0AAASdAHeZh94AAABe0lEQVQ4y5VT2XKDMAzk/z+uX5BOH0JzcAUb4xu2koB0kjA9PLMjYePV6nDRNA3KssTh8I6a/JQSQgj/RiRY61CYcYRSCkprDMMghDnnP2GaJmTG6jNx4byHMQZsRyLPecI8zy/gCxvyap8XiynG0ZJCje6mYFxYUo4RUZBWG4VgL9AGXpEJOc2+76EpZaUN1cGKUssgf/tOKZL6RMQZLILB64WQfx4GSjlm2sp0SHbekrg7D2rSWsNdQuecqDB2oqhvtPkB7+cHsp/WbspVXaNtO/gQpX5SQzoUxKcxojPjCD7diR4IK2Vxqlqcz2ccjyW67iYl4M5rCuZ5xtJ3czjAGBJsyPuEnsZFrzO4NMAKGdeW97nrv6W7gQMWfOlYflLajUw6z6P3AV6sh6Uaj2sg57z8w+Dv+5ldfM6mYOdS1ThdrmLrpkV760l+FnUC7urDi4hyWelB0tzWMjY0zM3gUWmHK9Xz2ltUyqEz9HLsooAV7w0zB3ju8hfE2PlCAIcwGgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Increase Lambda Timeout\"\n        title=\"Increase Lambda Timeout\"\n        src=\"/static/29749a014314a0e79755c72ee3b176b4/fcda8/lambdatimeout.png\"\n        srcset=\"/static/29749a014314a0e79755c72ee3b176b4/12f09/lambdatimeout.png 148w,\n/static/29749a014314a0e79755c72ee3b176b4/e4a3f/lambdatimeout.png 295w,\n/static/29749a014314a0e79755c72ee3b176b4/fcda8/lambdatimeout.png 590w,\n/static/29749a014314a0e79755c72ee3b176b4/efc66/lambdatimeout.png 885w,\n/static/29749a014314a0e79755c72ee3b176b4/d0143/lambdatimeout.png 1025w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<blockquote>\n<p>Same as DynamoDB’s RCU and WCU, if you want to use this Lambda in a real production stage, please adapt the settings in consequence (Memory, timeout, etc.).I provide you a great article for <a href=\"https://medium.com/@raupach/choosing-the-right-amount-of-memory-for-your-aws-lambda-function-99615ddf75dd\">choosing the right amount of memory for an AWS lambda</a></p>\n</blockquote>\n<p>I think we can test our Create Lambda function, so hit the Test button and you should have this result :</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/9b04afd01908050b0149d2b90cff9306/0f903/createresult.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 42.567567567567565%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABS0lEQVQoz4WRCW6DMBBFff8DtlLVZiMQ8I6NWUN+x4aQIFWqpadZ/D32eNjH1ycuRQbjDFStYb3dUTcWXHEILVCtlisBaSRKUSaNpnN6PcuOxRG5vOJSnnAWOaQXUA0R5EIjNjTFplUbttO7WHoOdtMSgl4nnIWiG6LlNcWNA/eefA1BccqRru4D3NAm3v2ICgbM+wBjqD1bow0t+r7HNE6JcRwxTYud5wf+WyJQy76hytpAU9HaeXT9gPs8Y7rvuVPBWPMvHqsV9N+sNApubOHHbnn62O7a2JF0r3Z3DAGy0WCH7BuFzFCZApUuIB2H6+mv6MMj0ee2RFadSXNDqfMUvzRm01kaDLupghyaVqBJBRp9a2iT2o90Fn6oqUBFl+bpcNyP+qfGrbpoDeVZVl1ouiIl3CYwm10Kljhcf5CLjCbOU+6pedfHgr8jM7HnQOZ2dAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Create Article success\"\n        title=\"Create Article success\"\n        src=\"/static/9b04afd01908050b0149d2b90cff9306/fcda8/createresult.png\"\n        srcset=\"/static/9b04afd01908050b0149d2b90cff9306/12f09/createresult.png 148w,\n/static/9b04afd01908050b0149d2b90cff9306/e4a3f/createresult.png 295w,\n/static/9b04afd01908050b0149d2b90cff9306/fcda8/createresult.png 590w,\n/static/9b04afd01908050b0149d2b90cff9306/efc66/createresult.png 885w,\n/static/9b04afd01908050b0149d2b90cff9306/c83ae/createresult.png 1180w,\n/static/9b04afd01908050b0149d2b90cff9306/0f903/createresult.png 1719w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Nice, the most difficult Lambda part has been done! The other one will be easier.</p>\n<p>Let’s tackle the <code class=\"language-text\">UpdateArticle</code> Lambda. Create a new lambda and provide this code :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> botocore<span class=\"token punctuation\">.</span>exceptions <span class=\"token keyword\">import</span> ClientError\n<span class=\"token keyword\">from</span> boto3<span class=\"token punctuation\">.</span>dynamodb<span class=\"token punctuation\">.</span>conditions <span class=\"token keyword\">import</span> Key\n        \ndynamodb_client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">(</span><span class=\"token string\">'dynamodb'</span><span class=\"token punctuation\">)</span>\ntable <span class=\"token operator\">=</span> dynamodb_client<span class=\"token punctuation\">.</span>Table<span class=\"token punctuation\">(</span><span class=\"token string\">'blog'</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> <span class=\"token builtin\">type</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">[</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">:</span>\n            body <span class=\"token operator\">=</span> json<span class=\"token punctuation\">.</span>loads<span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">[</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            body <span class=\"token operator\">=</span> event<span class=\"token punctuation\">[</span><span class=\"token string\">'body'</span><span class=\"token punctuation\">]</span>\n        \n        <span class=\"token comment\"># here we retrieve the same parameters as the FindBy lambda</span>\n        <span class=\"token comment\"># to identify what item to update.</span>\n        title <span class=\"token operator\">=</span> event<span class=\"token punctuation\">[</span><span class=\"token string\">'pathParameters'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">]</span>\n        category <span class=\"token operator\">=</span> event<span class=\"token punctuation\">[</span><span class=\"token string\">'pathParameters'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'category'</span><span class=\"token punctuation\">]</span>\n        \n        <span class=\"token comment\"># we will use the update_item in this case</span>\n        response <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span>update_item<span class=\"token punctuation\">(</span>\n            Key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">'title'</span><span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'category'</span><span class=\"token punctuation\">:</span> category\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            UpdateExpression<span class=\"token operator\">=</span><span class=\"token string\">\"set content = :content, author = :author\"</span><span class=\"token punctuation\">,</span>\n            ConditionExpression<span class=\"token operator\">=</span><span class=\"token string\">\"title = :title AND category = :category\"</span><span class=\"token punctuation\">,</span>\n            ExpressionAttributeValues<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">':title'</span><span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">':category'</span><span class=\"token punctuation\">:</span> category<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">':content'</span><span class=\"token punctuation\">:</span> body<span class=\"token punctuation\">[</span><span class=\"token string\">'content'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n                <span class=\"token string\">':author'</span><span class=\"token punctuation\">:</span> body<span class=\"token punctuation\">[</span><span class=\"token string\">'author'</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n            ReturnValues<span class=\"token operator\">=</span><span class=\"token string\">\"ALL_NEW\"</span>\n        <span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">return</span> response<span class=\"token punctuation\">[</span><span class=\"token string\">'Attributes'</span><span class=\"token punctuation\">]</span>\n    <span class=\"token keyword\">except</span> ClientError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">if</span> e<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">[</span><span class=\"token string\">'Error'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Code'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">\"ConditionalCheckFailedException\"</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">[</span><span class=\"token string\">'Error'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Message'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">raise</span> e</code></pre></div>\n<p>For this portion of code, we will need the primary key identifier to determine which object we want to update.</p>\n<p>Remember, when we created our DynamoDB table, we specified a <strong>partition key</strong> (title), and a <strong>sort key</strong> (category) which represents our <strong>primary key</strong>.</p>\n<p>It means that if we want to perform some actions in a particular item in our table, we have to specify these two properties.</p>\n<p>Good news: For the <strong>update_item</strong> operation, we can specify the <code class=\"language-text\">ReturnValues=&quot;ALL_NEW&quot;</code> property which will return the complete object updated.</p>\n<blockquote>\n<p>You have also the possibility to return only the attributes changed by changing the ReturnValues value. <a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_UpdateItem.html#API_UpdateItem_RequestSyntax\">See here</a> the possible values of the <strong>ReturnValues</strong> property.</p>\n</blockquote>\n<p>In this lambda, I decided to update my item with Conditional Expressions. It means that it will update my item only if it respects the <strong>ConditionsExpressions</strong>. If not, it will raise a <strong>ConditionalCheckFailedException</strong>.</p>\n<blockquote>\n<p>You can have a look at what are <a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/Expressions.ConditionExpressions.html\">conditions expressions</a>.</p>\n</blockquote>\n<p>Let’s configure our test event and test it just after :\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b168a192c163c9343552cfe23f341811/ee9b6/updatetest.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 32.43243243243243%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAABJ0AAASdAHeZh94AAAA4ElEQVQY052RzW6FIBSEef8HbLppF96qIPInCgLq9KC9N71t0kUXX4aZQ4bkwEIIUFrDGIuybdj+w74j5YyUEliMkcoMajGOAwcNj6q/2P/ManEpBWzwC16aDu98QGcnmLw9YfP+Qy8eWaJzKlCkds1gdvJoeoGb9IRDr2cIs6BTHp1xhL1UW/RVa14h/6EMBjtj9AFyCvBxBXPOgXMOLie8vgm0QqERLfiowJXEbejRSpqr4UQofc5q1o3ivKOpYwnx2uHkPaSUZFbMS0SI9NLiT59p0c+kb2SUr4+4U7NPHyPPX38Dh/wAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Update Article Test Event\"\n        title=\"Update Article Test Event\"\n        src=\"/static/b168a192c163c9343552cfe23f341811/fcda8/updatetest.png\"\n        srcset=\"/static/b168a192c163c9343552cfe23f341811/12f09/updatetest.png 148w,\n/static/b168a192c163c9343552cfe23f341811/e4a3f/updatetest.png 295w,\n/static/b168a192c163c9343552cfe23f341811/fcda8/updatetest.png 590w,\n/static/b168a192c163c9343552cfe23f341811/efc66/updatetest.png 885w,\n/static/b168a192c163c9343552cfe23f341811/ee9b6/updatetest.png 1041w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>As you can see, this is what we received :\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/3cb38152c91c940a7100947b68c06cda/4ed6a/updatesuccess.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 39.189189189189186%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABJ0AAASdAHeZh94AAABMUlEQVQoz4WR126DQBBF+f8/TBQsEdPMNrbB2pSb2cH1KUhHs0zXneKr/EZZnSCMgLIaxhuMYSTI3t85Jo3EoIdPqwbYaKlOQTvNucXvpUKnGrSyxlk0kEHCRAkdKWki+H2Q/eOsn1jCUM54t8INKKQWEIq2MwrW02YuY2CDp4nheHsLFyz85HFbr7gu6QX9Z19aZuigUHgfoCRNNFTgPNKcsK0bsy4rltuKfdvx37fvOzWUKBxpEGhynANiijztttEW6zE924fv3X5sSczLdDQszz+ohzOGscfFdOh1C+lJ7JkOMpFOyXAs5+R4S3oLe2H/oaNhLbPlhp1soL3kYkOHyOSgSyPjr5Ya9XS49jkk84i/wxpWXcUFudEj2cRX8/zf6w6nukQjar7k+/AXmmN/4DVkcQf0y8EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Update Article Test Event\"\n        title=\"Update Article Test Event\"\n        src=\"/static/3cb38152c91c940a7100947b68c06cda/fcda8/updatesuccess.png\"\n        srcset=\"/static/3cb38152c91c940a7100947b68c06cda/12f09/updatesuccess.png 148w,\n/static/3cb38152c91c940a7100947b68c06cda/e4a3f/updatesuccess.png 295w,\n/static/3cb38152c91c940a7100947b68c06cda/fcda8/updatesuccess.png 590w,\n/static/3cb38152c91c940a7100947b68c06cda/efc66/updatesuccess.png 885w,\n/static/3cb38152c91c940a7100947b68c06cda/c83ae/updatesuccess.png 1180w,\n/static/3cb38152c91c940a7100947b68c06cda/4ed6a/updatesuccess.png 1713w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>And if we check our DynamoDB blog table :\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/79233c457756de4feb53269d72c47be7/e8d6f/tableupdated.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 49.32432432432432%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABJ0AAASdAHeZh94AAACEUlEQVQoz3WSW2saURDH9zsp4qMXVMRHn/wMKWkDpqCC+B7fTH0ubdrEYqUQKIQ2rmDwsm6a9KVQW6i0RNfLXtS9edt/Z7cm0CY98OM/M+fsnNkzw6hTCbo6x8qYYWEaMIyH0XX9ntr0ej10u1/xg3QwEMA0v/RR+/wTN+SMhAEmkwkkSYIoThzbRpZlCIJAMRGj0cjxh8Mh+v0+2QrG4xEk0rlmgClzAl5c3KD7S6SNMczFCrAsbDabv7C2sVv9dymKgulUAVOtVnHO1lA5fY/TMxZnH1nU63U0m000Go0HabfbqFQqKBQKKBaLyB8cIJ/P4/DwGZidnUdIJpNIpVLIpFN4vLuLJ3t7yGQySKfT97DPZbNZJBIJuFwueDweeL1euN1u+P1+MOFwGBEil8thf/+pEwwGg47aBAIB+Hy+O9tW2w+FQojFYohGow6RSATxeBwMx3H4cF7F5acrXF9fgec7qNXoty/qaLVaYFkW/CWP9tZutZrguDY6nY6jt9jPwPM8mPXGgqwtoS4sWNsH1nUDq9Xm7rHX6z87mqYRBkxzjf8tRjdNCIqK8WwKczmhkETdkmjWplguDUooky1isZg5oyTLAk3DNxqt73TRnLquUddFQnO6z5gLiSp8DVk9hrF8SwnLUNWXlOCEqjyiap9T7A3ZJ5jNXhFHdEkJ83mZqj0mLVGsRN+8o4Q6fgN3GZqeacRlpQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Blog Table Updated\"\n        title=\"Blog Table Updated\"\n        src=\"/static/79233c457756de4feb53269d72c47be7/fcda8/tableupdated.png\"\n        srcset=\"/static/79233c457756de4feb53269d72c47be7/12f09/tableupdated.png 148w,\n/static/79233c457756de4feb53269d72c47be7/e4a3f/tableupdated.png 295w,\n/static/79233c457756de4feb53269d72c47be7/fcda8/tableupdated.png 590w,\n/static/79233c457756de4feb53269d72c47be7/efc66/tableupdated.png 885w,\n/static/79233c457756de4feb53269d72c47be7/c83ae/tableupdated.png 1180w,\n/static/79233c457756de4feb53269d72c47be7/e8d6f/tableupdated.png 1273w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Finally, let’s implement the latest one, create the DeleteArticle Lambda Function, and provide this code :</p>\n<div class=\"gatsby-highlight\" data-language=\"python\"><pre class=\"language-python\"><code class=\"language-python\"><span class=\"token keyword\">import</span> json\n<span class=\"token keyword\">import</span> boto3\n<span class=\"token keyword\">from</span> botocore<span class=\"token punctuation\">.</span>exceptions <span class=\"token keyword\">import</span> ClientError\n<span class=\"token keyword\">from</span> boto3<span class=\"token punctuation\">.</span>dynamodb<span class=\"token punctuation\">.</span>conditions <span class=\"token keyword\">import</span> Key\n        \ndynamodb_client <span class=\"token operator\">=</span> boto3<span class=\"token punctuation\">.</span>resource<span class=\"token punctuation\">(</span><span class=\"token string\">'dynamodb'</span><span class=\"token punctuation\">)</span>\ntable <span class=\"token operator\">=</span> dynamodb_client<span class=\"token punctuation\">.</span>Table<span class=\"token punctuation\">(</span><span class=\"token string\">'blog'</span><span class=\"token punctuation\">)</span>\n    \n<span class=\"token keyword\">def</span> <span class=\"token function\">lambda_handler</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">,</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n    <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span>\n        title <span class=\"token operator\">=</span> event<span class=\"token punctuation\">[</span><span class=\"token string\">'pathParameters'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'title'</span><span class=\"token punctuation\">]</span>\n        category <span class=\"token operator\">=</span> event<span class=\"token punctuation\">[</span><span class=\"token string\">'pathParameters'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'category'</span><span class=\"token punctuation\">]</span>\n        \n        response <span class=\"token operator\">=</span> table<span class=\"token punctuation\">.</span>delete_item<span class=\"token punctuation\">(</span>\n            Key<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>\n                <span class=\"token string\">'title'</span><span class=\"token punctuation\">:</span> title<span class=\"token punctuation\">,</span>\n                <span class=\"token string\">'category'</span><span class=\"token punctuation\">:</span> category\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">)</span>\n        \n        <span class=\"token keyword\">return</span> response\n    <span class=\"token keyword\">except</span> ClientError <span class=\"token keyword\">as</span> e<span class=\"token punctuation\">:</span>\n        <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">.</span>response<span class=\"token punctuation\">[</span><span class=\"token string\">'Error'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Message'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">raise</span> e</code></pre></div>\n<p>And the test event :\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/19a615e02b1e0a628d2efd72e6d0d007/ffe34/deleteevent.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 24.324324324324326%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABJ0AAASdAHeZh94AAAAuUlEQVQY052PwW6EMAxE+f9vbA/VKmQhDhA7cbubhKmBVtrzHp6e5LFG9kBEGMcRqgrsO3rvb1FrheSMIVuRFEW14bO196gHFRsXDJ/O4+PrBuKM0ndI7cjNOFz3P7/wn7Vr96Kdc0p2ofMTRj/DU0JgRRQ9TVIQRMzZnE+TZXO6sokZS1ak7wc2/YE8nojJLnTO4R42TFFwJ0ZcBWExVsa0rOZ0el42kGU+8GWKtsv2pmK1omKlx8u/Qq+C4cavsn4AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Delete Event\"\n        title=\"Delete Event\"\n        src=\"/static/19a615e02b1e0a628d2efd72e6d0d007/fcda8/deleteevent.png\"\n        srcset=\"/static/19a615e02b1e0a628d2efd72e6d0d007/12f09/deleteevent.png 148w,\n/static/19a615e02b1e0a628d2efd72e6d0d007/e4a3f/deleteevent.png 295w,\n/static/19a615e02b1e0a628d2efd72e6d0d007/fcda8/deleteevent.png 590w,\n/static/19a615e02b1e0a628d2efd72e6d0d007/efc66/deleteevent.png 885w,\n/static/19a615e02b1e0a628d2efd72e6d0d007/ffe34/deleteevent.png 1055w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Let’s try your Delete Lambda function and your item is now deleted from your table :\n<span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/abe9712f8ebe7fc8a79ad38b604c297a/0d98f/tableafterdelete.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 46.621621621621614%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABJ0AAASdAHeZh94AAABxUlEQVQoz21SS2saURi9P0oR/4EQRURBly4iuFA36QMUXOhC/0IX/oFCH3lBi8WF4qYtbbVJaKIO2jaWOpkZ5z3jqKd+lyg25MLhO9/5Hne4Z5hjqLB0Fa6hwDJ1GIaxg67rHMRVVeVR07RdnM/nmEwmGA4HuL2dQpJksE83M7R6vzCZipDEv5smhTfTAhqgSLkkSZwrisIvoVwUxV1NVlTohgn2+uMULz4I+Hz9Bz9/T3GnaHBsG5Zl/Qd7TzNNE6vVCtvjOA5msxlfzE5PjtFqtfDy1Ru8PXuPk/N3aDab6HQ6aLfbj6Lb7aLRaKBcLqNSqaBYLKJUKqFer4Ol02lks1k8OTrC82dPkTk8RCaTQT6fRy6XexSFQgHRaBQ+nw+BQADBYBB+vx+hUAgslUohfHCAarWKWq2GWCyGSCSCcDjM4xb7OfF4PA6aTSaTHIlEgn8IG4/H+PL1G35c30AYjUD5xcV3XF5dbdwbotfrcY14v9/HYDCAIAhcG23690EaWy6XUCwPsunBu39ny7Lhui7n5Co9+nq95u6SqxS39YeHUeFOsyHpDtzFErgfJFc9z+MLFosFBy2nX0mWZa6T0w/xD/QGVUnkK1DTAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Table after delete\"\n        title=\"Table after delete\"\n        src=\"/static/abe9712f8ebe7fc8a79ad38b604c297a/fcda8/tableafterdelete.png\"\n        srcset=\"/static/abe9712f8ebe7fc8a79ad38b604c297a/12f09/tableafterdelete.png 148w,\n/static/abe9712f8ebe7fc8a79ad38b604c297a/e4a3f/tableafterdelete.png 295w,\n/static/abe9712f8ebe7fc8a79ad38b604c297a/fcda8/tableafterdelete.png 590w,\n/static/abe9712f8ebe7fc8a79ad38b604c297a/efc66/tableafterdelete.png 885w,\n/static/abe9712f8ebe7fc8a79ad38b604c297a/c83ae/tableafterdelete.png 1180w,\n/static/abe9712f8ebe7fc8a79ad38b604c297a/0d98f/tableafterdelete.png 1276w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<h3>Let’s summarize</h3>\n<ul>\n<li>We created our IAM <strong>admin</strong> user</li>\n<li>With the admin user, we created the <strong>policy</strong> that <strong>allows our Lambdas to interact wich our DynamoDB</strong>.</li>\n<li>We <strong>attached this policy to our IAM Role</strong>.</li>\n<li>\n<p>We created <strong>5</strong> Lambda Functions :</p>\n<ul>\n<li><strong>GetArticles</strong> (which list all articles from blog table)</li>\n<li><strong>FinByTitleAndCategory</strong> (which list an article based from his primary key)</li>\n<li><strong>CreateArticle</strong> (which create an article item in blog table)</li>\n<li><strong>UpdateArticle</strong> (which update an article based from his primary key)</li>\n<li><strong>DeleteArticle</strong> (which delete an article based from his primary key)</li>\n</ul>\n</li>\n</ul>\n<p>Woah, we did a great job, congrats. Let’s move on now to the latest part, the <a href=\"../serverless-api-with-lambda-part-3\">creation of our API Gateway</a>.</p>","frontmatter":{"title":"Serverless App with AWS in ReactJS, using Lambda & API Gateway - Part 2","date":"May 30, 2020","description":"How to create a serverless app in AWS - Part 1 (The Lambda Functions)"}}},"pageContext":{"slug":"/serverless-api-with-lambda-part-2/","previous":{"fields":{"slug":"/serverless-api-with-lambda-part-1/"},"frontmatter":{"title":"Serverless App with AWS in ReactJS, using Lambda & API Gateway - Part 1"}},"next":{"fields":{"slug":"/serverless-api-with-lambda-part-3/"},"frontmatter":{"title":"Serverless App with AWS in ReactJS, using Lambda & API Gateway - Final part"}}}},"staticQueryHashes":[]}